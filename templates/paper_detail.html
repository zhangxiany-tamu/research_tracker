{% extends "base.html" %}

{% block title %}{{ paper.title }} - Research Tracker{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/">Home</a></li>
                <li class="breadcrumb-item"><a href="/papers">Papers</a></li>
                <li class="breadcrumb-item active">{{ paper.title[:50] }}{% if paper.title | length > 50 %}...{% endif %}</li>
            </ol>
        </nav>
    </div>
</div>

<!-- Paper Header -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card shadow-sm">
            <div class="card-body">
                <div class="row">
                    <div class="col-md-8">
                        <div class="d-flex align-items-start mb-3">
                            <span class="badge bg-primary fs-6 me-3">{{ paper.journal.abbreviation if paper.journal else 'Unknown' }}</span>
                            {% if paper.section %}
                            <span class="badge bg-info fs-6 me-3">{{ paper.section }}</span>
                            {% endif %}
                            {% if paper.publication_date %}
                            <span class="badge bg-success fs-6">{{ paper.publication_date.strftime('%b %d, %Y') }}</span>
                            {% endif %}
                        </div>
                        
                        <h1 class="h2 mb-3 text-dark">{{ paper.title }}</h1>
                        
                        {% if paper.authors %}
                        <div class="mb-3">
                            <h6 class="text-muted mb-2">
                                <i class="fas fa-users me-2"></i>Authors
                            </h6>
                            <div class="d-flex flex-wrap">
                                {% for author_name in paper.authors | format_authors %}
                                <span class="badge bg-light text-dark me-2 mb-1 p-2">{{ author_name }}</span>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}
                        
                        {% if paper.topics %}
                        <div class="mb-3">
                            <h6 class="text-muted mb-2">
                                <i class="fas fa-tags me-2"></i>Research Topics
                            </h6>
                            <div class="d-flex flex-wrap">
                                {% for topic in paper.topics %}
                                <span class="badge bg-secondary me-2 mb-1">{{ topic.name }}</span>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}
                    </div>
                    
                    <div class="col-md-4">
                        <div class="text-end">
                            <div class="mb-3">
                                {% if paper.url %}
                                <a href="{{ paper.url }}" class="btn btn-primary btn-lg mb-2 d-block" target="_blank">
                                    <i class="fas fa-external-link-alt me-2"></i>View Full Paper
                                </a>
                                {% endif %}
                                {% if paper.pdf_url %}
                                <a href="{{ paper.pdf_url }}" class="btn btn-outline-danger btn-lg d-block" target="_blank">
                                    <i class="fas fa-file-pdf me-2"></i>Download PDF
                                </a>
                                {% endif %}
                            </div>
                            
                            <!-- Quick Stats -->
                            <div class="card info-card">
                                <div class="card-body p-3">
                                    <h6 class="card-title mb-3">Paper Information</h6>
                                    <ul class="list-unstyled mb-0 small info-list">
                                        <li class="mb-2">
                                            <strong>Journal:</strong><br>
                                            {{ paper.journal.name if paper.journal else 'Unknown' }}
                                        </li>
                                        {% if paper.doi %}
                                        <li class="mb-2">
                                            <strong>DOI:</strong><br>
                                            <code class="small">{{ paper.doi }}</code>
                                        </li>
                                        {% endif %}
                                        {% if paper.publication_date %}
                                        <li class="mb-2">
                                            <strong>Published:</strong><br>
                                            {{ paper.publication_date.strftime('%B %d, %Y') }}
                                        </li>
                                        {% endif %}
                                        {% if paper.accepted_date %}
                                        <li class="mb-2">
                                            <strong>Accepted:</strong><br>
                                            {{ paper.accepted_date.strftime('%B %d, %Y') }}
                                        </li>
                                        {% endif %}
                                        <li class="mb-0">
                                            <strong>Added to Tracker:</strong><br>
                                            {{ paper.scraped_date.strftime('%b %d, %Y') if paper.scraped_date else 'Unknown' }}
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Abstract Section -->
{% if paper.abstract %}
<div class="row mb-4">
    <div class="col-12">
        <div class="card shadow-sm paper-info-card">
            <div class="card-header bg-white section-header">
                <h5 class="mb-0">
                    <i class="fas fa-file-text me-2 text-primary"></i>Abstract
                </h5>
            </div>
            <div class="card-body">
                <p class="mb-0 abstract-text">{{ paper.abstract }}</p>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Author Details Section -->
{% if paper.authors %}
<div class="row mb-4">
    <div class="col-12">
        <div class="card shadow-sm">
            <div class="card-header bg-white">
                <h5 class="mb-0">
                    <i class="fas fa-user-friends me-2 text-primary"></i>Author Details
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    {% for author_name in paper.authors | format_authors %}
                    <div class="col-md-6 col-lg-4 mb-3">
                        <div class="d-flex align-items-center">
                            <div class="author-avatar">
                                <i class="fas fa-user"></i>
                            </div>
                            <div>
                                <h6 class="mb-0">{{ author_name }}</h6>
                                {% if author_name == 'others' %}
                                <small class="text-muted">Additional Authors</small>
                                {% else %}
                                <small class="text-muted">Author</small>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Research Topics Section -->
{% if paper.topics %}
<div class="row mb-4">
    <div class="col-12">
        <div class="card shadow-sm">
            <div class="card-header bg-white">
                <h5 class="mb-0">
                    <i class="fas fa-tags me-2 text-primary"></i>Research Topics & Keywords
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    {% for topic in paper.topics %}
                    <div class="col-md-6 col-lg-4 mb-3">
                        <div class="d-flex align-items-center">
                            <div class="topic-avatar">
                                <i class="fas fa-tag"></i>
                            </div>
                            <div>
                                <h6 class="mb-0">{{ topic.name }}</h6>
                                <small class="text-muted">Research Area</small>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Citation Information -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card shadow-sm">
            <div class="card-header bg-white">
                <h5 class="mb-0">
                    <i class="fas fa-quote-left me-2 text-primary"></i>Citation Information
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6>APA Format</h6>
                        <div class="citation-box">
                            <code>
                                {% for author_name in paper.authors | format_authors %}
                                    {% if loop.index0 > 0 %}
                                        {% if loop.last %} & {% else %}, {% endif %}
                                    {% endif %}
                                    {{ author_name }}
                                {% endfor %}
                                {% if paper.publication_date %}
                                 ({{ paper.publication_date.year }})
                                {% endif %}. 
                                {{ paper.title }}. 
                                <em>{{ paper.journal.name if paper.journal else 'Unknown Journal' }}</em>
                                {% if paper.doi %}, {{ paper.doi }}{% endif %}.
                            </code>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <h6>BibTeX Format</h6>
                        <div class="citation-box">
                            {% if paper.bibtex %}
                            <pre><code>{{ paper.bibtex }}</code></pre>
                            {% else %}
                            <code>
@article{paper{{ paper.id }},<br>
&nbsp;&nbsp;title = { {{ paper.title }} },<br>
&nbsp;&nbsp;author = { 
                                {% for author_name in paper.authors | format_authors %}
                                    {% if loop.index0 > 0 %} and {% endif %}{{ author_name }}
                                {% endfor %}
                                },<br>
&nbsp;&nbsp;journal = { {{ paper.journal.name if paper.journal else 'Unknown Journal' }} },<br>
{% if paper.publication_date %}&nbsp;&nbsp;year = { {{ paper.publication_date.year }} },<br>{% endif %}
{% if paper.doi %}&nbsp;&nbsp;doi = { {{ paper.doi }} },<br>{% endif %}
&nbsp;&nbsp;url = { {{ paper.url }} }<br>
}
                            </code>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Action Buttons -->
<div class="row mb-4">
    <div class="col-12">
        <div class="action-buttons">
            <div class="d-flex justify-content-between align-items-center">
                <a href="/papers" class="btn btn-secondary btn-lg btn-action">
                    <i class="fas fa-arrow-left me-2"></i>Back to Papers
                </a>
                
                <div>
                    {% if paper.url %}
                    <a href="{{ paper.url }}" class="btn btn-primary btn-lg btn-action me-2" target="_blank">
                        <i class="fas fa-external-link-alt me-2"></i>View Full Paper
                    </a>
                    {% endif %}
                    <a href="/papers?journal={{ paper.journal.name if paper.journal else '' }}" class="btn btn-outline-primary btn-lg btn-action">
                        <i class="fas fa-search me-2"></i>More from {{ paper.journal.abbreviation if paper.journal else 'Journal' }}
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Related Papers Section (placeholder for future enhancement) -->
<div class="row">
    <div class="col-12">
        <div class="card shadow-sm">
            <div class="card-header bg-white">
                <h5 class="mb-0">
                    <i class="fas fa-link me-2 text-primary"></i>Related Papers
                </h5>
            </div>
            <div class="card-body">
                <div class="related-papers-placeholder">
                    <i class="fas fa-info-circle me-2"></i>
                    Related papers functionality coming soon. This will show papers with similar topics or from the same authors.
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}